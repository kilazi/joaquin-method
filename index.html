<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Método Joaquín Vega — Decision Trees</title>
<style>
:root {
  --bg: #0f1117;
  --surface: #1a1d27;
  --surface2: #242836;
  --border: #2e3346;
  --text: #e4e6ed;
  --text-dim: #8b8fa3;
  --accent: #6c8cff;
  --accent-dim: #4a6ad4;
  --green: #34d399;
  --green-bg: #0d3328;
  --red: #f87171;
  --red-bg: #3b1c1c;
  --yellow: #fbbf24;
  --yellow-bg: #3b3416;
  --purple: #a78bfa;
  --purple-bg: #2d2548;
  --cyan: #22d3ee;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

/* Layout */
.app { display: flex; height: 100vh; }
.sidebar {
  width: 280px;
  min-width: 280px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.sidebar-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
}
.sidebar-header h1 {
  font-size: 15px;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 4px;
}
.sidebar-header p {
  font-size: 11px;
  color: var(--text-dim);
}
.sidebar-nav {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}
.nav-group {
  margin-bottom: 12px;
}
.nav-group-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: var(--text-dim);
  padding: 6px 8px;
  font-weight: 600;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.15s;
  color: var(--text);
}
.nav-item:hover { background: var(--surface2); }
.nav-item.active { background: var(--accent-dim); color: #fff; }
.nav-item .tree-num {
  font-size: 10px;
  font-weight: 700;
  background: var(--surface2);
  color: var(--text-dim);
  width: 22px;
  height: 22px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.nav-item.active .tree-num { background: rgba(255,255,255,0.2); color: #fff; }

/* Main content */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.main-header {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}
.main-header h2 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 4px;
}
.main-header .desc {
  font-size: 12px;
  color: var(--text-dim);
  max-width: 700px;
  line-height: 1.5;
}
.mode-toggle {
  display: flex;
  gap: 4px;
  background: var(--surface);
  border-radius: 8px;
  padding: 3px;
  flex-shrink: 0;
}
.mode-btn {
  padding: 6px 12px;
  border: none;
  background: transparent;
  color: var(--text-dim);
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.15s;
}
.mode-btn.active { background: var(--accent); color: #fff; }

/* Tree view */
.tree-container {
  flex: 1;
  overflow: auto;
  padding: 24px;
}

/* Step-by-step mode */
.step-view {
  max-width: 640px;
  margin: 0 auto;
  padding-top: 20px;
}
.step-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 16px;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.step-badge {
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 3px 8px;
  border-radius: 4px;
  margin-bottom: 12px;
}
.step-badge.question { background: rgba(108,140,255,0.15); color: var(--accent); }
.step-badge.action { background: rgba(52,211,153,0.15); color: var(--green); }
.step-badge.wait { background: rgba(251,191,36,0.15); color: var(--yellow); }
.step-badge.stop { background: rgba(248,113,113,0.15); color: var(--red); }

.step-question {
  font-size: 17px;
  font-weight: 600;
  line-height: 1.4;
  margin-bottom: 16px;
}
.step-action {
  font-size: 16px;
  font-weight: 700;
  line-height: 1.4;
  margin-bottom: 12px;
}
.step-explanation {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.6;
  margin-bottom: 16px;
}
.step-quote {
  font-size: 12px;
  font-style: italic;
  color: var(--purple);
  background: var(--purple-bg);
  padding: 10px 14px;
  border-radius: 8px;
  border-left: 3px solid var(--purple);
  margin-bottom: 16px;
  line-height: 1.5;
}
.step-buttons {
  display: flex;
  gap: 10px;
}
.step-btn {
  flex: 1;
  padding: 12px 16px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}
.step-btn.yes {
  background: var(--green);
  color: #000;
}
.step-btn.yes:hover { background: #4ade80; }
.step-btn.no {
  background: var(--red);
  color: #000;
}
.step-btn.no:hover { background: #fca5a5; }
.step-btn.option {
  background: var(--surface2);
  color: var(--text);
  border: 1px solid var(--border);
}
.step-btn.option:hover { background: var(--border); }
.step-btn.restart {
  background: var(--surface2);
  color: var(--text-dim);
  border: 1px solid var(--border);
}
.step-btn.restart:hover { background: var(--border); }

/* Full tree mode */
.full-tree {
  min-width: fit-content;
}
.tree-node {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.node-box {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 14px 18px;
  max-width: 300px;
  min-width: 200px;
  text-align: center;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
}
.node-box:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(108,140,255,0.15);
}
.node-box.question-node { border-color: var(--accent); }
.node-box.action-node { border-color: var(--green); background: var(--green-bg); }
.node-box.wait-node { border-color: var(--yellow); background: var(--yellow-bg); }
.node-box.stop-node { border-color: var(--red); background: var(--red-bg); }
.node-box .node-label {
  font-size: 12px;
  line-height: 1.4;
  font-weight: 500;
}
.node-children {
  display: flex;
  gap: 20px;
  margin-top: 20px;
  position: relative;
}
.node-children::before {
  content: '';
  position: absolute;
  top: -20px;
  left: 50%;
  width: 2px;
  height: 20px;
  background: var(--border);
}
.branch {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.branch-label {
  font-size: 11px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 10px;
  margin-bottom: 10px;
}
.branch-label.yes-label { background: var(--green-bg); color: var(--green); }
.branch-label.no-label { background: var(--red-bg); color: var(--red); }

/* Flow overview */
.flow-section {
  max-width: 700px;
  margin: 0 auto;
  padding: 20px 0;
}
.flow-step {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  padding: 14px 0;
  border-left: 2px solid var(--border);
  margin-left: 15px;
  padding-left: 24px;
  position: relative;
}
.flow-step::before {
  content: attr(data-num);
  position: absolute;
  left: -14px;
  top: 12px;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: var(--accent);
  color: #fff;
  font-size: 11px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
}
.flow-step .flow-tree {
  font-weight: 700;
  color: var(--accent);
  font-size: 13px;
  min-width: 30px;
}
.flow-step .flow-desc {
  font-size: 13px;
  color: var(--text-dim);
  line-height: 1.5;
}
.flow-step .flow-desc strong { color: var(--text); }

/* Breadcrumb */
.breadcrumb {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}
.crumb {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s;
}
.crumb.yes-crumb { background: var(--green-bg); color: var(--green); }
.crumb.no-crumb { background: var(--red-bg); color: var(--red); }
.crumb:hover { opacity: 0.8; }

/* Stats bar */
.stats-bar {
  padding: 10px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 24px;
  font-size: 11px;
  color: var(--text-dim);
  background: var(--surface);
}
.stat-item span { color: var(--text); font-weight: 600; }

/* Mobile */
@media (max-width: 768px) {
  .sidebar { display: none; }
  .sidebar.open {
    display: flex;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 100;
    width: 280px;
    box-shadow: 4px 0 20px rgba(0,0,0,0.5);
  }
  .mobile-header {
    display: flex !important;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    align-items: center;
    gap: 12px;
  }
  .hamburger {
    background: none; border: none;
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    padding: 4px;
  }
  .main-header { padding: 12px 16px; }
  .step-view { padding-top: 10px; }
  .step-card { padding: 16px; }
  .step-question { font-size: 15px; }
  .tree-container { padding: 16px; }
}
.mobile-header { display: none; }
.overlay {
  display: none;
  position: fixed; top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 99;
}
.overlay.open { display: block; }

/* Tooltip */
.tooltip {
  position: fixed;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 12px;
  max-width: 300px;
  z-index: 1000;
  pointer-events: none;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  line-height: 1.5;
}
</style>
</head>
<body>
<div class="app">
  <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1>Metodo Joaquin Vega</h1>
      <p>Modified Fibonacci Trading Method</p>
    </div>
    <nav class="sidebar-nav" id="sidebarNav"></nav>
  </aside>
  <main class="main">
    <div class="mobile-header">
      <button class="hamburger" onclick="openSidebar()">&#9776;</button>
      <span style="font-size:14px;font-weight:600;color:var(--accent)">Metodo JV</span>
    </div>
    <div class="main-header" id="mainHeader">
      <div>
        <h2 id="treeTitle">Execution Flow</h2>
        <p class="desc" id="treeDesc">The complete trading session workflow — from preparation to trade classification.</p>
      </div>
      <div class="mode-toggle">
        <button class="mode-btn active" id="modeStep" onclick="setMode('step')">Step-by-Step</button>
        <button class="mode-btn" id="modeTree" onclick="setMode('tree')">Full Tree</button>
      </div>
    </div>
    <div class="tree-container" id="treeContainer"></div>
    <div class="stats-bar">
      <div class="stat-item"><span>13</span> Decision Trees</div>
      <div class="stat-item"><span>148</span> Nodes</div>
      <div class="stat-item"><span>15</span> Source Videos</div>
      <div class="stat-item"><span>72%</span> Method Coverage</div>
    </div>
  </main>
</div>

<script>
// Decision tree data — loaded from JSON
let TREES = null;
let currentTree = null;
let currentMode = 'step';
let stepHistory = [];
let currentNode = null;

// Navigation structure
const NAV_GROUPS = [
  {
    title: 'Start Here',
    items: [
      { id: 'flow', label: 'Execution Flow', icon: '>' },
    ]
  },
  {
    title: 'Reading Model',
    items: [
      { id: 'T1_Cycle_Identification', label: 'Cycle Identification' },
      { id: 'T2_Fractality_And_Evolution', label: 'Fractality & Evolution' },
      { id: 'T3_Retracement_Completion', label: 'Retracement Completion' },
      { id: 'T4_Context_Reading', label: 'Context Reading' },
    ]
  },
  {
    title: 'Attack Model',
    items: [
      { id: 'T5_Liquidity_And_Entry_Strategy', label: 'Entry Strategy' },
      { id: 'T9_161_200_Zone_Trading', label: '161-200 Zone Trading' },
    ]
  },
  {
    title: 'Management',
    items: [
      { id: 'T6_Trade_Classification', label: 'Trade Classification' },
      { id: 'T7_Post_Entry_Management', label: 'Post-Entry Management' },
      { id: 'T8_Partial_Profit_Strategy', label: 'Partial Strategy' },
      { id: 'T12_Super_Winner_Psychology', label: 'Super-Winner Psychology' },
    ]
  },
  {
    title: 'Foundation',
    items: [
      { id: 'T10_Risk_And_Business_Plan', label: 'Risk & Business Plan' },
      { id: 'T11_Method_Architecture', label: 'Method Architecture' },
      { id: 'T13_Chart_Analysis_Methodology', label: 'Chart Analysis Method' },
    ]
  }
];

async function init() {
  try {
    const resp = await fetch('trees.json');
    TREES = await resp.json();
  } catch(e) {
    // Fallback: try loading from decision_trees.json
    try {
      const resp = await fetch('../decision_trees.json');
      TREES = await resp.json();
    } catch(e2) {
      document.getElementById('treeContainer').innerHTML = '<p style="padding:40px;color:var(--red)">Error loading decision trees. Make sure trees.json is in the webapp folder.</p>';
      return;
    }
  }
  renderNav();
  showFlow();
}

function renderNav() {
  const nav = document.getElementById('sidebarNav');
  let html = '';
  NAV_GROUPS.forEach(group => {
    html += `<div class="nav-group"><div class="nav-group-title">${group.title}</div>`;
    group.items.forEach(item => {
      const num = item.id === 'flow' ? '>' : item.id.match(/T(\d+)/)?.[1] || '?';
      html += `<div class="nav-item" data-id="${item.id}" onclick="selectTree('${item.id}')">
        <span class="tree-num">${num}</span>
        <span>${item.label}</span>
      </div>`;
    });
    html += '</div>';
  });
  nav.innerHTML = html;
}

function selectTree(id) {
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.querySelector(`.nav-item[data-id="${id}"]`)?.classList.add('active');
  closeSidebar();

  if (id === 'flow') {
    showFlow();
    return;
  }

  const tree = TREES.trees.find(t => t.tree_name === id);
  if (!tree) return;

  currentTree = tree;
  document.getElementById('treeTitle').textContent = tree.tree_name.replace(/_/g, ' ').replace(/^T\d+\s/, '');
  document.getElementById('treeDesc').textContent = tree.tree_description;

  if (currentMode === 'step') {
    startStepMode(tree);
  } else {
    renderFullTree(tree);
  }
}

function setMode(mode) {
  currentMode = mode;
  document.getElementById('modeStep').classList.toggle('active', mode === 'step');
  document.getElementById('modeTree').classList.toggle('active', mode === 'tree');
  if (currentTree) {
    if (mode === 'step') startStepMode(currentTree);
    else renderFullTree(currentTree);
  }
}

// --- Execution Flow ---
function showFlow() {
  currentTree = null;
  document.getElementById('treeTitle').textContent = 'Trading Session Workflow';
  document.getElementById('treeDesc').textContent = 'Follow this sequence for a complete trading session. Click any tree reference to jump to it.';

  const flow = TREES.execution_flow;
  const container = document.getElementById('treeContainer');

  let html = '<div class="flow-section">';
  flow.forEach((step, i) => {
    const match = step.match(/^(\d+)\.\s(T\d+)\s—\s(.+)$/);
    if (match) {
      const [, num, treeRef, desc] = match;
      html += `<div class="flow-step" data-num="${num}">
        <span class="flow-tree" style="cursor:pointer" onclick="selectTree('${getTreeId(treeRef)}')">${treeRef}</span>
        <span class="flow-desc"><strong>${desc}</strong></span>
      </div>`;
    }
  });
  html += '</div>';
  container.innerHTML = html;
}

function getTreeId(ref) {
  const tree = TREES.trees.find(t => t.tree_name.startsWith(ref));
  return tree ? tree.tree_name : ref;
}

// --- Step-by-Step Mode ---
function startStepMode(tree) {
  stepHistory = [];
  currentNode = tree.root;
  renderStep();
}

function renderStep() {
  const container = document.getElementById('treeContainer');
  const node = currentNode;
  const isQuestion = !!node.question;
  const isAction = !!node.action;

  let actionType = 'action';
  if (isAction) {
    const a = node.action.toUpperCase();
    if (a.includes('WAIT') || a.includes('MONITOR')) actionType = 'wait';
    else if (a.includes('STOP') || a.includes('BROKEN') || a.includes('DEAD') || a.includes('LOSER')) actionType = 'stop';
  }

  let html = '<div class="step-view">';

  // Breadcrumb
  if (stepHistory.length > 0) {
    html += '<div class="breadcrumb">';
    stepHistory.forEach((h, i) => {
      const cls = h.choice === 'yes' ? 'yes-crumb' : 'no-crumb';
      const label = h.choiceLabel || h.choice;
      html += `<span class="crumb ${cls}" onclick="goBack(${i})">${label}</span>`;
    });
    html += '</div>';
  }

  html += '<div class="step-card">';

  if (isQuestion) {
    html += `<div class="step-badge question">Decision</div>`;
    html += `<div class="step-question">${node.question}</div>`;

    if (node.quote_es) {
      html += `<div class="step-quote">"${node.quote_es}"</div>`;
    }
    if (node.note) {
      html += `<div class="step-explanation">${node.note}</div>`;
    }

    // Check for options (T13-style)
    if (node.options) {
      html += '<div class="step-buttons" style="flex-direction:column">';
      for (const [key, val] of Object.entries(node.options)) {
        const label = key.replace(/_/g, ' ').replace(/^\w/, c => c.toUpperCase());
        html += `<button class="step-btn option" onclick="chooseOption('${key}')">${label}</button>`;
      }
      html += '</div>';
    }
    // Check for sub_tree (T7/T8-style)
    else if (node.sub_tree) {
      html += '<div class="step-buttons">';
      const st = node.sub_tree;
      const yLabel = node.yes_label || 'Yes';
      const nLabel = node.no_label || 'No';
      html += `<button class="step-btn yes" onclick="chooseSubTree('yes', '${yLabel}')">${yLabel}</button>`;
      html += `<button class="step-btn no" onclick="chooseSubTree('no', '${nLabel}')">${nLabel}</button>`;
      html += '</div>';
    }
    // Normal yes/no
    else if (node.yes || node.no) {
      const yLabel = node.yes_label || 'Yes';
      const nLabel = node.no_label || 'No';
      html += '<div class="step-buttons">';
      if (node.yes) html += `<button class="step-btn yes" onclick="choose('yes', '${yLabel}')">${yLabel}</button>`;
      if (node.no) html += `<button class="step-btn no" onclick="choose('no', '${nLabel}')">${nLabel}</button>`;
      html += '</div>';
    }
  } else if (isAction) {
    html += `<div class="step-badge ${actionType}">${actionType === 'wait' ? 'Wait' : actionType === 'stop' ? 'Stop' : 'Action'}</div>`;
    html += `<div class="step-action">${node.action}</div>`;
    if (node.explanation) html += `<div class="step-explanation">${node.explanation}</div>`;
    if (node.quote_es) html += `<div class="step-quote">"${node.quote_es}"</div>`;

    // Check for "then" continuation
    if (node.then) {
      html += `<button class="step-btn yes" style="margin-top:12px;flex:unset;padding:10px 20px" onclick="goThen()">Continue &rarr;</button>`;
    }
    // Check for sub_decisions
    if (node.sub_decisions) {
      html += `<button class="step-btn yes" style="margin-top:12px;flex:unset;padding:10px 20px" onclick="goSubDecision()">Next Decision &rarr;</button>`;
    }

    html += '<div style="margin-top:16px"><button class="step-btn restart" onclick="startStepMode(currentTree)">Restart Tree</button></div>';
  }

  html += '</div></div>';
  container.innerHTML = html;
  container.scrollTop = 0;
}

function choose(choice, label) {
  stepHistory.push({ node: currentNode, choice, choiceLabel: label });
  currentNode = choice === 'yes' ? currentNode.yes : currentNode.no;
  renderStep();
}

function chooseOption(key) {
  stepHistory.push({ node: currentNode, choice: 'yes', choiceLabel: key.replace(/_/g, ' ') });
  currentNode = currentNode.options[key];
  renderStep();
}

function chooseSubTree(choice, label) {
  stepHistory.push({ node: currentNode, choice, choiceLabel: label });
  const st = currentNode.sub_tree;
  currentNode = choice === 'yes' ? (st.yes || st) : (st.no || st);
  renderStep();
}

function goThen() {
  stepHistory.push({ node: currentNode, choice: 'yes', choiceLabel: 'Continue' });
  currentNode = currentNode.then;
  renderStep();
}

function goSubDecision() {
  stepHistory.push({ node: currentNode, choice: 'yes', choiceLabel: 'Next' });
  currentNode = currentNode.sub_decisions;
  renderStep();
}

function goBack(index) {
  currentNode = stepHistory[index].node;
  stepHistory = stepHistory.slice(0, index);
  renderStep();
}

// --- Full Tree Mode ---
function renderFullTree(tree) {
  const container = document.getElementById('treeContainer');
  container.innerHTML = `<div class="full-tree">${renderNodeHTML(tree.root, 0)}</div>`;
}

function renderNodeHTML(node, depth) {
  if (!node) return '';
  const isQuestion = !!node.question;
  const isAction = !!node.action;

  let cls = 'question-node';
  if (isAction) {
    const a = node.action.toUpperCase();
    if (a.includes('WAIT') || a.includes('MONITOR')) cls = 'wait-node';
    else if (a.includes('STOP') || a.includes('BROKEN') || a.includes('DEAD') || a.includes('LOSER')) cls = 'stop-node';
    else cls = 'action-node';
  }

  const label = isQuestion
    ? node.question.length > 60 ? node.question.slice(0, 57) + '...' : node.question
    : node.action.length > 60 ? node.action.slice(0, 57) + '...' : node.action;

  const title = isQuestion ? node.question : `${node.action}\n\n${node.explanation || ''}`;

  let html = `<div class="tree-node">
    <div class="node-box ${cls}" title="${title.replace(/"/g, '&quot;')}">
      <div class="node-label">${label}</div>
    </div>`;

  if (isQuestion) {
    const hasYesNo = node.yes || node.no;
    const hasOptions = node.options;
    const hasSubTree = node.sub_tree;

    if (hasYesNo) {
      html += '<div class="node-children">';
      if (node.yes) {
        const yLabel = node.yes_label || 'Yes';
        html += `<div class="branch"><span class="branch-label yes-label">${yLabel}</span>${renderNodeHTML(node.yes, depth+1)}</div>`;
      }
      if (node.no) {
        const nLabel = node.no_label || 'No';
        html += `<div class="branch"><span class="branch-label no-label">${nLabel}</span>${renderNodeHTML(node.no, depth+1)}</div>`;
      }
      html += '</div>';
    } else if (hasOptions) {
      html += '<div class="node-children">';
      for (const [key, val] of Object.entries(node.options)) {
        html += `<div class="branch"><span class="branch-label yes-label">${key.replace(/_/g, ' ')}</span>${renderNodeHTML(val, depth+1)}</div>`;
      }
      html += '</div>';
    } else if (hasSubTree) {
      html += `<div class="node-children">${renderNodeHTML(node.sub_tree, depth+1)}</div>`;
    }
  }

  // Render "then" and "sub_decisions" continuations
  if (node.then) {
    html += `<div class="node-children"><div class="branch"><span class="branch-label yes-label">then</span>${renderNodeHTML(node.then, depth+1)}</div></div>`;
  }
  if (node.sub_decisions) {
    html += `<div class="node-children"><div class="branch"><span class="branch-label yes-label">detail</span>${renderNodeHTML(node.sub_decisions, depth+1)}</div></div>`;
  }

  html += '</div>';
  return html;
}

// --- Mobile ---
function openSidebar() {
  document.getElementById('sidebar').classList.add('open');
  document.getElementById('overlay').classList.add('open');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').classList.remove('open');
}

// Init
init();
</script>
</body>
</html>
